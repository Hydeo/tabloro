"use strict";function preload(){chatInput=document.getElementById("chatInput"),Assets.preload(game)}function create(){setupStage(),setupTable(),setupTiles(),Controls.add(),UI.init(),setupPlayers(),Cursor.set()}function setupStage(){document.getElementById("please_wait").remove(),game.stage.disableVisibilityChange=!0,game.scale.scaleMode=Phaser.ScaleManager.RESIZE,game.scale.setScreenSize(!0),game.scale.onResize=UI.update;var e=game.canvas;e.id="boardgame",game.canvas.oncontextmenu=function(e){e.preventDefault()},game.physics.startSystem(Phaser.Physics.ARCADE),game.world.setBounds(0,0,World.width,World.height)}function setupTable(){table=game.add.tileSprite(0,0,World.width,World.height,"table")}function addCards(e,a,t){var r=[];return R.forEach(function(e){var s=a.create(100,100,"tile",e);s.defaultFrame=e,t&&t.config.hidden&&T.hide(s),T.scale(.5,s),T.setDefaultTint(15658734,s),R.compose(T.setId,Cursor.reset,T.networkAble,T.stackable,T.rotateable,T.draggable,T.centerAnchor)(s),r.push(s.id),Controls.target=s})(e),Controls.target}function addTokens(e,a,t,r){R.forEach.idx(function(e,s){var o=tokens.create(t+s,r-2*s,e);T.setId(o),T.scale(.6,o),T.setDefaultTint(a,o),R.compose(Cursor.reset,T.networkAble,T.rotateable,T.draggable,T.centerAnchor)(o)})(e)}function setupTiles(){stacks=game.add.group(),redDice=game.add.group(),blueDice=game.add.group(),G.init(game),stack1=S.create({image:"stack1",x:400,y:300,shuffle:!0,hidden:!0}),stack2=S.create({image:"stack2",x:100,y:300,shuffle:!0,hidden:!1}),cards1=game.add.group(),cards1.z=15,cards1.rotateBy=Math.PI/2,addCards(R.concat(R.range(1,38),R.range(40,49)),cards1,stack1);var e=addCards([39],cards1);e.rotation+=Math.PI,e.x=Screen.x/2,e.y=Screen.y/2,tokens=game.add.group(),tokens.z=16,tokens.rotateBy=Math.PI/2,addTokens(R.repeatN("soldier",10),3158816,330,60),addTokens(R.repeatN("soldier",10),3390463,400,60),addTokens(R.repeatN("soldier",10),14496563,470,60),addTokens(R.repeatN("soldier",10),2280482,540,60),addTokens(R.repeatN("soldier",10),16772642,610,60),addTokens(R.repeatN("soldier",10),16777215,680,60),Dice.add(redDice,0,14496563),Dice.add(redDice,1,14496563)}function setupPlayers(){UI.updateNames(),players=game.add.group(),players.z=17,player={cursor:cursorId,name:playerName}}function update(){if(Network.ready!==!1){S.update(),G.update();var e={x:Math.floor(game.input.activePointer.worldX),y:Math.floor(game.input.activePointer.worldY)};if(game.input.keyboard.isDown(Phaser.Keyboard.UP))game.camera.y-=30;else if(game.input.keyboard.isDown(Phaser.Keyboard.DOWN))game.camera.y+=30;else if(game.input.keyboard.isDown(Phaser.Keyboard.LEFT))game.camera.x-=30;else if(game.input.keyboard.isDown(Phaser.Keyboard.RIGHT))game.camera.x+=30;else if(game.input.keyboard.isDown(Phaser.Keyboard.ENTER)&&chatInput.value.length>0){var a=chatInput.value;chatInput.value="",Network.server.chat(a)}game.input.mouse.event&&(game.input.mouse.event.wheelDeltaX&&(game.camera.x-=game.input.mouse.event.wheelDeltaX),game.input.mouse.event.wheelDeltaY&&(game.camera.y-=game.input.mouse.event.wheelDeltaY)),player.lastPosition&&player.lastPosition.x==e.x&&player.lastPosition.y==e.y||(Network.server.moveCursor(e),player.lastPosition=e)}}var Screen={},World={width:4e3,height:2e3};Screen.x=window.innerWidth*window.devicePixelRatio,Screen.y=window.innerHeight*window.devicePixelRatio;var game=new Phaser.Game(Screen.x,Screen.y,Phaser.AUTO,"boardgame",{preload:preload,create:Network.setup,update:update}),redDice,blueDice,cards1,stacks,tokens,players,table,playerList={},player={},stack1,stack2,chatInput;