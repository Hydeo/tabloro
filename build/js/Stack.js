"use strict";var S={};S.offsetX=1.2,S.offsetY=-1,S.create=function(t){var n=T.centerAnchor(stacks.create(0,0,t.image));n.width=280,n.height=280,n.align=[],n.config=t,T.draggable(n),n.input.useHandCursor=!1,n.events.onInputDown.add(S.onDragStack),n.events.onInputUp.add(S.onDropStack),T.setId(n),n.cards=[],n.position.set(t.x,t.y),G.addText("0",n,Utils.childTo(0,.78),"#3b74aa");var e=R.compose(Cursor.reset,S.align(n),Utils.aboveCorner(n),S.assign(n),T.scale(.4));return t.shuffle&&R.compose(e,G.addText("SHUFFLE"))(UI.handCursor(G.button(S.onShuffleButton,n))),t.hidden||R.compose(e,G.addText("FLIP"))(UI.handCursor(G.button(S.onFlipButton,n))),n},S.align=R.curry(function(t,n){var e=R.last(t.align);return t.align.push(n),e&&(n.x+=e.width*(t.align.length-1)),S.assignRelativePosition(t,n)}),S.assignRelativePosition=function(t,n){return n.relativePosition?n:(n.relativePosition={x:n.x-t.x,y:n.y-t.y},n)},S.assign=R.curry(function(t,n){return n.stack=t,n}),S.onDragStack=function(t){Network.server.stackDragStart(t.id),Controls.hide()},S.onDropStack=function(t){var n=t.position.clone();n.width=t.width,n.height=t.height,Network.server.stackDragStop(t.id,n),S.tidy(t)},S.onShuffleButton=function(){var t=this;Network.server.shuffleStack(t.id)},S.onFlipButton=function(t){var n=t.stack;Network.server.flipStack(n.id)},S.bringToTop=function(t){return t.bringToTop(),t},S.tidy=function(t){var n;return R.forEach.idx(function(e,i){var r=G.findTile(e);r.inputEnabled=!1,Utils.alignPosition(r,S.calculateCardPos(t,i)),t.config.hidden&&T.hide(r),r&&(n=r),S.bringToTop(r)})(t.cards),n&&(n.inputEnabled=!0),n&&UI.handCursor(n),S.alignElements(t),S.updateCounter(t)},S.overlap=R.curry(function(t,n){return game.physics.arcade.overlap(t,n)}),S.flipCards=function(t){R.forEach(function(t){var n=G.findTile(t);0===n._frame.index?T.show(n):T.hide(n)})(t.cards)},S.update=function(){stacks.forEach(function(t){(t.input.isDragged||t.remoteDragged)&&(S.alignElements(t),S.alignStackCards(t))})},S.calculateCardPos=function(t,n){return{x:t.x+S.offsetX*n,y:t.y+S.offsetY*n}},S.alignStackCards=function(t){R.forEach.idx(function(n,e){var i=G.findTile(n);i.inputEnabled=!1,Utils.alignPosition(i,S.calculateCardPos(t,e))})(t.cards)},S.alignElements=function(t){R.forEach(S.moveRelativeTo(t))(t.align)},S.moveRelativeTo=R.curry(function(t,n){return n.relativePosition?(n.x=t.x+n.relativePosition.x,n.y=t.y+n.relativePosition.y,n):n}),S.updateCounter=function(t){return t.setText(t.cards.length),t},S.updateCards=function(t,n){var e=R.difference(n,t.cards);R.forEach(S.removeCardFromStacks)(e),t.cards=n,e.length?R.forEach(function(n){var e=G.findTile(n),i=game.add.tween(e).to(t.position,200,Phaser.Easing.Cubic.In,!0,0,!1);i.onComplete.add(function(){S.tidy(t)})})(e):S.tidy(t)},S.removeCardFromStacks=function(t){var t=Number(t);return R.forEach(function(n){n.cards=R.reject(R.eq(t))(n.cards),S.tidy(n)})(stacks.children),t};